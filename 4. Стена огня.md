# Firewall


## Содержание

- [Общие сведения](#общие-сведения)
  - [Что такое firewall](#что-такое-firewall)
  - [Для чего нужен firewall](#для-чего-нужен-firewall)
  - [Функции firewall](#функции-firewall)
  - [Правила firewall](#правила-firewall)
  - [Типы firewall](#типы-firewall)
    - [Аппаратный firewall](#аппаратный-firewall)
    - [Программный firewall](#программный-firewall)
- [iptables](#iptables)
  - [Порядок прохождения таблиц и цепочек](#порядок-прохождения-таблиц-и-цепочек)
  - [Уровни вложенности таблиц, цепочек и правил](#уровни-вложенности-таблиц,-цепочек-и-правил)
  - [Синтаксис iptables](#синтаксис-iptables)
    - [Цепочки](#цепочки)
    - [Таблицы](#таблицы)
    - [Действия](#действия)
    - [Команды](#команды)
    - [Критерии](#критерии)
  - [Состояние соединений](#состояние-соединений)
  - [Примеры настройки iptables](#примеры-настройки-iptables)
    - [Как заблокировать IP-адрес в iptables](#как-заблокировать-ip-адрес-в-iptables)
    - [Как разрешить IP-адрес в iptables](#как-разрешить-ip-адрес-в-iptables)
    - [Как открыть порт в iptables](#как-открыть-порт-в-iptables)
    - [Как закрыть порт в iptables](#как-закрыть-порт-в-iptables)
    - [Как блокировать трафик по MAC-адресу](#как-блокировать-трафик-по-mac-адресу)
- [nftables](#nftables)
  - [Основы nftables](#основы-nftables)
  - [Основные различия с iptables](#основные-различия-с-iptables)
  - [Структуры для хранения правил nftables](#структуры-для-хранения-правил-nftables)
  - [Семьи nftables (families)](#семьи-nftables-(families))
- [firewalld](#firewalld)
  - [Основные концепции в firewalld](#основные-концепции-в-firewalld)
    - [Зоны](#зоны)
    - [Постоянство правил](#постоянство-правил)


## Общие сведения

### Что такое firewall

`Firewall` (межсетевой экран, брандмауэр) представляет собой программно-аппаратный или программный комплекс, 
который отслеживает сетевые пакеты, блокирует или разрешает их прохождение. В фильтрации трафика firewall 
опирается на установленные параметры - правила.

Современные межсетевые экраны располагаются на периферии сети (между внутренней сетью, ПК и внешней сетью - 
Интернетом), ограничивают транзит трафика, установку нежелательных соединений и подобные действия за счет 
средств фильтрации и аутентификации.

Принцип работы firewall:

![Принцип работы firewall](./images/Принцип%20работы%20межсетевого%20экрана.png)


### Для чего нужен firewall

Главная задача firewall – это фильтрация трафика между зонами сети. Он может использоваться для разграничения 
прав доступа в сеть, защиты от сканирования сети компании, проведения сетевых атак. Проще говоря, межсетевой экран – 
это одно из устройств, при помощи которого обеспечивается сетевая безопасность компании.


### Функции firewall

Firewall может:

- остановить подмену трафика. Представим, что ваша компания обменивается данными с одним их своих подразделений, 
при этом ваши IP-адреса известны. Злоумышленник может попытаться замаскировать свой трафик под данные офиса, 
но отправить его с другого IP. Брандмауэр обнаружит подмену и не даст ему попасть внутрь вашей сети;
- защитить корпоративную сеть от DDoS-атак. То есть ситуаций, когда злоумышленники пытаются вывести из строя 
ресурсы компании, отправляя им множество запросов с зараженных устройств. Если система умеет распознавать такие атаки, 
она формирует определенную закономерность и передает ее брандмауэру для дальнейшей фильтрации злонамеренного трафика;
- заблокировать передачу данных на неизвестный IP-адрес. Допустим, сотрудник фирмы скачал вредоносный файл и заразил 
свой компьютер, что привело к утечке корпоративной информации. При попытке вируса передать информацию на неизвестный 
IP-адрес брандмауэр автоматически остановит это;
- установить запрет на пропуск трафика с/на определенные веб-сайтов. Например, запретить смотреть youtube или 
одноклассники с рабочего компьютера;
- задать перечень запрещенных и разрешенных портов, что позволяет регулировать доступ к определенным сервисам и 
приложениям. Например, заблокировав порт 80, можно запретить доступ пользователей к веб-сайтам;
- блокировать доступ трафика определенных протоколов.


### Правила firewall

Сетевой трафик, проходящий через firewall, сопоставляется с правилами, чтобы определить, пропускать его или нет.
Правило межсетевого экрана состоит из условия (IP-адрес, порт) и действия, которое необходимо применить к пакетами, 
подходящим под заданное условие. К действиям относятся команды разрешить (`accept`), отклонить (`reject`) и 
отбросить (`drop`). Эти условия указывают firewall, что именно нужно совершить с трафиком: 

- разрешить — пропустить трафик;
- отклонить — не пропускать трафик, а пользователю выдать сообщение-ошибку «недоступно»;
- отбросить — заблокировать передачу и не выдавать ответного сообщения.


### Типы firewall

Firewall делятся на два основных типа: аппаратные и программные. 

#### Аппаратный firewall

Аппаратный firewall – это, как правило, специальное оборудование, составляющие которого (процессоры, платы и т.п.) 
спроектированы специально для обработки трафика. 

Работает они на специальном ПО — это необходимо для увеличения производительности оборудования. Примерами 
аппаратного межсетевого экрана выступают такие устройства, как Cisco ASA, FortiGate, Cisco FirePower, UserGate 
и другие. 

Аппаратные firewall более мощные по сравнению с программными, однако это влияет на стоимость решений.

#### Программный firewall

Программный firewall – это программное обеспечение, которое устанавливается на устройств, реальное или виртуальное.
Через такой межсетевой экран перенаправляется весь трафик внутрь рабочей сети. К программным относятся брандмауэр 
в Windows и `iptables` в Linux. 

Программные firewall, как правило, дешевле и могут устанавливаться не только на границах сети, но и на 
рабочих станциях пользователей. Из основных недостатков — более низкая пропускная способность и сложность 
настройки в ряде случаев. 



## iptables

`iptables` — это утилита командной строки, используемая для управления встроенным firewall `netfilter`, 
доступным в ядре Linux, начиная с версии 2.4.


### Порядок прохождения таблиц и цепочек

Любой, поступивший пакет на сервер с iptables, проходит через ядро, а именно firewall netfilter. 
Каждый из них классифицируется в зависимости от его назначения, попадает в соответствующую ему таблицу 
и проходит по цепочкам, содержащим правила, установленные администратором.

На основе этих правил, выполняется действие — принять пакет, отбросить, удалить или передать следующему узлу сети. 
Иллюстрация, представленная ниже, наглядно показывает путь прохождения пакета по системе:

![Путь прохождения пакета по системе](./images/Путь%20прохождения%20пакета%20по%20системе.png)


### Уровни вложенности таблиц, цепочек и правил

Самым верхним уровнем представления являются таблицы, которые содержат набор свойственных им цепочек. 
Цепочки содержат списки правил. Схематично «матрешка» выглядит следующим образом:

![Уровни вложенности таблиц, цепочек и правил](./images/Уровни%20вложенности%20таблиц,%20цепочек%20и%20правил.png)


### Синтаксис iptables

Сетевой экран `iptables` очень гибок в настройке и имеет огромное количество разнообразных ключей и опций. 
Общий вид управляющей команды:

```shell
iptables таблица команда цепочка критерии действие
```

#### Цепочки

Существует 5 видов цепочек:
- `PREROUTING` — предназначена для первичной обработки входящих пакетов, адресованных как непосредственно серверу, 
так и другим узлам сети. Сюда попадает абсолютно весь входящий трафик для дальнейшего анализа.
- `INPUT` — для входящих пакетов, отправленных непосредственно этому серверу.
- `FORWARD` — для проходящих пакетов, не адресованных этому компьютеру, предназначены для передачи следующему узлу, 
в случае, если сервер выполняет роль маршрутизатора.
- `OUTPUT` — для пакетов, отправленных с этого сервера.
- `POSTROUTING` — здесь оказываются пакеты, предназначенные для передачи на другие узлы сети.

#### Таблицы

В netfilter существуют 5 типов таблиц, каждая из них имеет свое назначение.

`Таблица raw`

Содержит цепочки `PREROUTING` и `OUTPUT`, здесь производятся манипуляции с пакетами до задействования 
механизма определения состояний.

`Таблица mangle`

Предназначена для модификации заголовков сетевых пакетов, таких параметров как `ToS` (Type of Service), 
`TTL` (Time To Live), `MARK`. Содержит все существующие пять цепочек.

`Таблица nat`

Используется для трансляции сетевых адресов, т.е. подмены адреса получателя/отправителя, применяется, 
если сервер используется в качестве маршрутизатора. Содержит цепочки `PREROUTING`, `OUTPUT`, `POSTROUTING`.

`Таблица filter`

Основная таблица, служит для фильтрации пакетов, именно здесь происходит принятие решений о разрешении или 
запрете дальнейшего движения пакета в системе. Используется по умолчанию, если явно не указано имя другой таблицы. 
Содержит цепочки `INPUT`, `FORWARD` и `OUTPUT`.

`Таблица security`

Используется для взаимодействия с внешними системами безопасности, в частности с SELinux и AppArmor. 
Содержит цепочки `INPUT`, `OUTPUT` и `FORWARD`.

Имена таблиц принято писать строчными буквами.

#### Действия

Правилами задается поведение для `iptables`, каким образом поступить с тем или иным пакетом при попадании 
под заданные критерии. Решения, которые принимает брандмауэр, называют действиями, самые распространенные из них:

- `ACCEPT` — разрешить дальнейшее прохождение пакета по системе;
- `DROP` — выбросить пакет без уведомления отправителя;
- `REJECT` — отказать в прохождении пакета с уведомлением отправителя, такой способ может привести к дополнительным 
затратам ресурсов процессора, поэтому, в большинстве случаев рекомендуется использовать DROP;
- `LOG` — зафиксировать информацию о пакете в файле системного журнала;
- `MARK` — позволяет помечать определенные пакеты, например для маршрутизации, данная метка перестает существовать, 
как только пакет покинет брандмауэр;
- `CONNMARK` — то же самое, что и MARK, только для соединений;
- `QUEUE` — отправляет пакет в очередь приложению для дальнейшего взаимодействия;
- `RETURN` — прекращение движения пакета по текущей цепочке и возврат в предыдущую цепочку. Если текущая цепочка 
единственная — к пакету будет применено действие по умолчанию;
- `REDIRECT` — перенаправляет пакет на указанный порт, в пределах этого же узла, применяется для реализации 
«прозрачного» прокси;
- `DNAT` — подменяет адрес получателя в заголовке IP-пакета, основное применение — предоставление доступа 
к сервисам снаружи, находящимся внутри сети;
- `SNAT` — служит для преобразования сетевых адресов, применимо, когда за сервером находятся машины, 
которым необходимо предоставить доступ в Интернет, при этом от провайдера имеется статический IP-адрес;
- `MASQUERADE` — то же, что и SNAT, но главное отличие в том, что может использоваться, когда провайдер 
предоставляет динамический адрес, создаёт дополнительную нагрузку на систему по сравнению с SNAT;
- `TOS` — позволяет управлять битами в одноименном поле заголовка IP-пакета;
- `ULOG` — более продвинутый вариант записи информации, может писать как в обычный текстовый файл, так и в базу данных;
- `TTL` — используется для изменения значения поля одноименного заголовка IP-пакета, устанавливает время жизни пакета.


#### Команды
Для iptables команда — это инструкция к действию, при помощи них можно добавлять, удалять и сбрасывать все правила, 
задавать действия по умолчанию и многое другое. Команды могут подаваться как в сокращенном, так и в полном виде, 
более подробно в таблице:

Вид | Описание                                                                                                                                  |
----|-------------------------------------------------------------------------------------------------------------------------------------------
—append, -A | добавить правило в конец указанной цепочки                                                                                                
—check, -C | проверить существующие правила в заданной цепочке                                                                                         
—delete, -D | удалить правило с указанным номером в заданной цепочке                                                                                    
—insert, -I | вставить правило с заданным номером, без указания номера — правило будет по умолчанию добавлено первым                                    
—replace, -R | заменить правило с указанным номером                                                                                                      
—list, -L | вывести список всех действующих правил со всех цепочек, если указать интересующую цепочку — вывод будет сделан только по ней              
—list-rules, -S | построчный вывод всех правил во всех цепочках, если после ключа указать имя цепочки — будут выведены только ее правила                    
—flush, -F | удалить все правила, при указании имени цепочки — правила удаляться только в ней                                                          
—zero, -Z | обнулить все счетчики во всех цепочках, при указании цепочки — обнуление произойдет только в ней                                          
—new, -N | создать пользовательскую цепочку                                                                                                          
—delete-chain, -X | удалить пользовательскую цепочку                                                                                                          
—policy, -P | установить политику по умолчанию для цепочки, обычно это ACCEPT или DROP, она будет применена к пакетам, не попавшим ни под один критерий 
—rename-chain, -E | переименовать цепочку, сначала указывается текущее имя, через пробел — новое                                                              
—help, -h | вывести справочную информацию по синтаксису iptables                                                                                      


#### Критерии

Чтобы к пакету применить какое-либо действие, необходимо, чтобы он попал под определенные критерии. Одно правило 
может содержать несколько критериев. Они, как и команды, имеют полную и сокращенную форму. Некоторые из них 
поддерживают логическую НЕ, если перед ними поставить знак ! — критерий будет инвертирован. Список в таблице ниже:

Вид | Описание
---|---
—protocol, -p | указывает протокол, такие как tcp, udp, udplite и другие, поддерживаемые системой, ознакомиться со списком можно в файле /etc/protocols
—source, -s	| указывает адрес источника пакета, в качестве значения можно указать как один IP-адрес, так и диапазон
—destination, -d | адрес получателя, синтаксис аналогичен предыдущему пункту
—match, -m | подключает указанный модуль
—jump, -j | когда правило подошло — выполнить указанное действие
—goto, -g | перейти к указанной цепочке правил
—in-interface, -i | задает входящий сетевой интерфейс
—out-interface, -o | указывает исходящий сетевой интерфейс
—fragment, -f | указывает на фрагменты фрагментированных пакетов
—set-counters, -c | устанавливает начальные значения счетчиков пакетов и байт
—destination-port, —dport | порт получателя пакета
—source-port, —sport | порт отправителя пакета


### Состояние соединений

Система отслеживания состояния соединений conntrack — важная часть сетевого стека linux, встроенная в ядро. 
Используется для сопоставления пакетов с конкретными соединениями. Под анализ попадают все пакеты, 
кроме помеченных `NOTRACK`, в таблице `raw`. Все пакеты классифицируются на:

- `NEW` — открывается новое соединение, пришел только первый пакет;
- `ESTABLISHED` — соединение установлено, пришел уже не первый пакет в рамках этого сеанса. 
При правильной настройке iptables — такие пакеты проходят по системе без фильтрации, поскольку она уже была 
выполнена для первого пакета соединения;
- `RELATED` — открывается новое соединение, связанное с другим сеансом, имеющим статус `ESTABLISHED`;
- `INVALID` — помечаются пакеты, которые не связаны ни с одним из существующих соединений, и не могут создать новое, 
их невозможно идентифицировать. В целях безопасности рекомендуется остановить движение таких пакетов по системе, 
используя действие `DROP`.


### Примеры настройки iptables

#### Как заблокировать IP-адрес в iptables

Допустим, необходимо заблокировать компьютер с IP-адресом 172.10.10.1, тогда правило будет выглядеть следующим образом:

```shell
iptables -A INPUT -s 172.10.10.1 -j DROP
```

#### Как разрешить IP-адрес в iptables

Необходимо разрешить весь трафик к серверу для клиента с IP-адресом 192.168.111.1:

```shell
iptables -A INPUT -s 192.168.111.1 -j ACCEPT
```

#### Как открыть порт в iptables

Откроем порты веб-сервера для обеспечения работы HTTP протокола — порт 80, и поддержки HTTPS протокола 
совместно с SSL — порт 443. Также для доступа к серверу по SSH откроем порт 22:

```shell
iptables -A INPUT -p tcp -m multiport --dports 22,80,443 -j ACCEPT
```

#### Как закрыть порт в iptables

Закроем доступ к FTP серверу, работающему на 21 порту:

```shell
iptables -A INPUT -p tcp --dport 21 -j DROP
```

#### Как блокировать трафик по MAC-адресу

Устройство, которому хотим запретить доступ к серверу, имеет MAC-адрес 00:0A:EF:76:23:12:

```shell
iptables -A INPUT -m mac --mac-source 00:0A:EF:76:23:12 -j DROP
```


## nftables

По мере развития `iptables` обрастал серьезными проблемами на функциональном уровне и в дизайне. 
Взвесив все за и против, разработчики решили отказаться от метода костылей и создали новый файер, 
имя которому `nftables`. Данный framework доступен с версии ядра Linux 3.13 и позволяет запускать 
команды со старым синтаксисом iptables. По умолчанию же используется новый синтаксис построения команд. 
В основном используются такие понятия, как наборы, также для правил используют карты и конкатенации (склейки).

### Основы nftables

`Набор` (`set`) - множество похожих по смыслу значений для ключей правил, объединенных общим именем или конструкцией, 
состоящей из скобок. Позволяет описывать словари и карты. Позволяет обходиться одним правилом в том случае, 
где в iptables пришлось бы использовать цепочку правил. Например:

```markdown
Набор портов: {22, 23}
Набор протоколов: {telnet, http, https}
```

`Карта` (`maps`) - карта используется для сопоставления обрабатываемой информации с правилом на основе пар значение - 
ключ. Создание карт основано на использовании инфраструктуры наборов (`set`). Существует два типа карт - точные карты 
(`literal maps`) и карты присяжных (`verdict maps`). 

`Точные карты` - это набор пар (`sets`) критерий_совпадения: действие. Например:

```shell
nft add rule ip nat prerouting dnat tcp dport map { 80 : 192.168.1.100, 8888 : 192.168.1.101 }
```

Это правило с помощью карты осуществляет перенаправление (`DNAT`) с порта TCP назначения 80 на IP-адрес 
назначения 192.168.1.100, а с порта 8888 - на IP-адрес 192.168.1.101.

`Интервалы` (`intervals`) - описываются с помощью синтаксической конструкции значение-значение Интервал 
обозначает указание диапазона значений. Например: 192.168.1.0-192.168.1.105 обозначает диапазон IP-адресов 
1-1023 обозначает диапазон портов интернет-протокола. Вот пример соответствующего правила:

```shell
nft add rule inet table1 chain_input ip daddr 192.168.0.1-192.168.0.105 drop
```

Данное правило указывает отбрасывать все пакеты для семейства правил inet в таблице table1 в цепочке 
chain_input с IPv4 адресом назначения от 192.168.0.1 до 192.168.0.105.

### Основные различия с iptables

- Синтаксис iptables построен таким образом, что ключам правил всегда предшествует двойное или одинарное тире. 
В отличие от этого, nftables использует другой синтаксис, перенятый у tcpdump.
- В iptables вы получаете сразу готовое количество таблиц с фиксированным набором уже настроенных в них цепочек правил. 
Что приводило к потерям производительности из-за существования неиспользуемых цепочек. В nftables таблицы и цепочки 
полностью настраиваются.
- В nftables выражения - это базовый строительный блок правила. В связи с этим правило представляет собой 
последовательность с выражениями, которые выполняются последовательно слева направо.
- В nftables можно указать несколько действий в одном правиле.
- Нет по умолчанию счетчика цепочек и правил. Вы можете включить его по желанию.
- Лучшая поддержка обновления правил в процессе работы.
- Возможность одновременного администрирования стеков IPv4 и IPv6 благодаря новому семейству inet, позволяющему 
регистрировать цепочки правил, видящие одновременно трафик обоих стеков протоколов.
- Генерация наборов и карт инфраструктуры. Это новая возможность, позволяет использовать дополнительные конфигурации, 
такие как словари, карты и интервалы, для достижения ориентированной на производительность классификации пакетов.
- Поддержка конкатенаций (склеек). Начиная с ядра Linux 4.1, вы можете объединять несколько различных ключей и 
комбинировать их со словарями и картами. Идея состоит в построении цветка значений, хеширующихся для получения 
- высокой производительности при выполнении правил.
- Подключения поддержки новых протоколов без обновления ядра. Для обновления nftables практически всегда достаточно 
обновления самого пакета, без каких-либо лишних действий.

### Структуры для хранения правил nftables

В целом всё похоже на `iptables`:

- `Таблицы` - содержат ссылку на контейнеры цепочек правил.
- `Цепочка` - содержит наборы правил, выполняемых в порядке очереди.
- `Правило` - семантическая конструкция, позволяющая выбрать действия, которые нужно осуществить с описываемым 
правилом набором данных.

### Семьи nftables (families)

Вся инфраструктура nftables предназначена для работы с различными семействами адресов (`families`) разных протоколов 
(`IPv4`, `IPv6`, `ARP`, `MAC`). Ранее для обработки разных семейств адресов использовались разные утилиты - `iptables`, 
`ip6tables`, `arptables`, `ebtables`. Теперь с помощью введения понятия семейства обработка происходит в рамках одного 
программного продукта. На текущий момент существуют следующие семейства:

- `ip` - таблицы этого семейства будут видеть трафик (пакеты) протокола IPv4;
- `ip6` - таблицы этого семейства будут видеть трафик (пакеты) протокола IPv6;
- `inet` - в таблицах этого семейства будет обрабатываться трафик (пакеты) протоколов IPv4 и IPv6. Правила для ipv4 
не будут влиять на пакеты IPv6. Правила, подходящие под оба протокола, будут влиять на пакеты обоих протоколов;
- `arp` - таблицы этого семейства видят трафик `arp`-протокола;
- `bridge` - в таблицах будут видеться пакеты, коммутируемые на уровне L2 OSI. Это семейство аналог `ebtables`;
- `netdev` - это семейство, аналогов которого нет в x_tables. Оно видит все пакеты, которые только были переданы 
драйвером в стек протоколов.


## firewalld

`firewalld` — программное обеспечение для управления брандмауэрами, поддерживаемое многими дистрибутивами Linux. 
Выступает в качестве клиентского интерфейса для встроенных в ядро Linux систем фильтрации пакетов `nftables` и 
`iptables`.

### Основные концепции в firewalld

#### Зоны

Демон `firewalld` управляет группами правил, используя элементы, называемые зонами. Зоны представляют собой 
набор правил, который определяет разрешенный трафик в зависимости от уровня доверия в сети. Зоне назначаются 
сетевые интерфейсы, определяющие поведение, которое должен разрешать брандмауэр.

Такая гибкость позволяет легко изменять правила в зависимости от среды, особенно в случае с компьютерами, 
которые часто перемещаются между сетями (например, с ноутбуками). Вы можете использовать более строгие правила, 
например, запретить большую часть трафика в публичных сетях WiFi и ввести менее строгие ограничения для домашней сети. 
Для сервера эти зоны не так важны, поскольку его сетевая среда редко изменяется, если это вообще происходит.

Вне зависимости от того, насколько динамична сетевая среда, будет полезно познакомиться с общей идеей, лежащей 
в основе заданных зон firewalld. Заданные зоны в firewalld упорядочены от наименее доверенных к наиболее доверенным:

- `drop`: самый низкий уровень доверия. Все входящие соединения отбрасываются без ответа и разрешаются только 
исходящие соединения.
- `block`: аналогично вышеописанному, но запросы входящих соединений не просто отбрасываются, а отклоняются 
с сообщением icmp-host-prohibited или icmp6-adm-prohibited.
- `public`: публичные сети, к которым нет доверия. Вы не доверяете другим компьютерам, но можете разрешать 
отдельные входящие соединения на разовой основе.
- `external`: внешние сети, если вы используете брандмауэр в качестве шлюза. Эта зона настроена для маскировки NAT, 
чтобы ваша внутренняя сеть оставалась частной, но доступной.
- `internal`: другая сторона внешней зоны, используемая для внутренней части шлюза. Компьютеры в основном достойны 
доверия, доступны некоторые дополнительные службы.
- `dmz`: используется для компьютеров в ДМЗ (изолированные компьютеры, у которых нет доступа к остальной части 
вашей сети). Разрешены только некоторые входящие соединения.
- `work`: используется для рабочих компьютеров. Большинство компьютеров в сети являются доверенными. Могут быть 
разрешены некоторые дополнительные службы.
- `home`: домашняя среда. Обычно подразумевается, что вы доверяете большей части других компьютеров и что будут 
приниматься запросы еще нескольких служб.
- `trusted`: все компьютеры в сети являются доверенными. Наиболее открытый из доступных вариантов, который следует 
использовать с осторожностью.

Для использования брандмауэра можно создавать правила и изменять свойства зон, а также назначать сетевые интерфейсы 
в наиболее подходящие зоны.

#### Постоянство правил

В firewalld правила можно применять к текущему набору правил времени исполнения или использовать как постоянные. 
При добавлении или изменении правила по умолчанию изменяется только работающий брандмауэр. После перезагрузки 
системы или службы firewalld сохраняются только постоянные правила.

Большинство операций firewall-cmd могут принимать флаг --permanent, указывающий на необходимость применения 
изменений к постоянной конфигурации. Кроме того, текущую конфигурацию брандмауэра можно сохранить в постоянной 
конфигурации с помощью команды firewall-cmd --runtime-to-permanent.

Такое разделение конфигурации времени исполнения и постоянной конфигурации позволяет безопасно тестировать правила 
на активном брандмауэре и просто перезагружать его в случае возникновения проблем.



## Источники

0. [https://selectel.ru/blog/firewall/](https://selectel.ru/blog/firewall/)
1. [https://games.mail.ru/pc/articles/hard/chto_takoe_fajrvol_zachem_on_nuzhen_i_kak_ego_vkljuchit/](https://games.mail.ru/pc/articles/hard/chto_takoe_fajrvol_zachem_on_nuzhen_i_kak_ego_vkljuchit/)
2. [https://selectel.ru/blog/setup-iptables-linux/](https://selectel.ru/blog/setup-iptables-linux/)
3. [https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-8-ru](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-using-firewalld-on-centos-8-ru)
4. [https://wiki.archlinux.org/title/nftables](https://wiki.archlinux.org/title/nftables)
5. [https://losst.pro/kak-polzovatsya-nftables](https://losst.pro/kak-polzovatsya-nftables)