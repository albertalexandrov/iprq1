# rsync


rsync — утилита для удаленной синхронизации и копирования файлов. Ее еще можно назвать «SCP на стероидах». 
Из преимуществ: позволяет не передавать файлы полностью, а только изменения в них, синхронизирует директории и 
файлы, имеет встроенный механизм сжатия. 

## Возможности Rsync

Ключевое преимущество утилиты — синхронизация структуры директорий целиком или файлов по-отдельности. 
Можно синхронизировать данные между узлами сети, сетевыми хранилищами, дисками и каталогами.

При первой синхронизации данные файлов копируются целиком. При повторной, `rsync` проверяет наличие изменений 
в исходном файле и передает лишь `измененные блоки и байты`.

`rsync` использует алгоритм сжатия данных `Deflate` c помощью модифицированной библиотеки `zlib`, поэтому 
пропускная способность каналов связи используется экономичнее в сравнении с утилитой `scp`.

Вместе с файлами или каталогами, `rsync` реплицирует также и разрешения на них. Вместе с этим, для работы 
не требуются права root, поэтому `rsync` подойдет для целей резервного копирования и восстановления данных.

## Синтаксис rsync

В этом разделе мы приведем основные параметры, с которыми выполняется `rsync`. Синтаксис в общем виде выглядит так:

```shell
rsync -options <source> <destination>
```

- `-options` — параметры, с которыми должна выполняться утилита.
- `<source>` — каталог или файл, который является источником.
- `<destination>` — каталог или файл, который является приемником.

Ниже приведены основные параметры, с которыми вызывается Rsync:

- `-v, —verbose` — для отображения отладочной информации в процессе синхронизации.
- `-q, —quiet` — для запрета вывода об ошибках.
- `-c, —checksum` — для сравнения файлов по контрольной сумме, вместо даты/времени изменения или размера.
- `-a, —archive` — включение сжатия данных.
- `-r, —recursive` — для включения режима рекурсивного копирования директорий.
- `-b, —backup` — для активации режима режима резервного копирования, чтобы создавались резервные копии оригинальных файлов при обновлении.
- `—backup-dir=<каталог>` — каталог, в котором будут храниться резервные копии.
- `—suffix=SUFFIX` — суффикс для файлов, сохраняемых в режиме резервного копирования..
- `-u, —update` — для пропуска обновления файлов с более поздней датой изменения.
- `-l, —links` — для сохранения символических ссылок.
- `-H, —hard-links` — для сохранения жестких ссылок.
- `-p, —perms` — для сохранения разрешений объекта (файла или каталога).
- `-E, —executability` — для сохранения прав на исполнение.
- `—chmod=<права>` — для изменения прав доступа на конкретные объекты (файлы или каталоги).
- `-o, —owner` — для сохранения владельца объекта.
- `-g, —group` — для сохранения группы владельца.
- `-S, —sparse` — для выполнения дефрагментации одновременно с копированием данных.
- `-n, —dry-run` — для тестирования без копирования;
- `-W, —whole-file` — для копирования файлов целиком, по умолчанию копируется только часть с изменениями.
- `—delete` — для удаления старых файлов, если их уже нет в источнике копирования.
- `—delete-before` — для удаления файлов в папке назначения до начала синхронизации.
- `—max-delete=<количество файлов>` — для ограничения максимального числа удаляемых файлов.
- `—max-size=<размер файлов>` — для ограничения максимального размера передаваемых файлов.
- `—min-size=<размер файлов>` — для ограничения минимального размера передаваемых файлов.
- `-z, —compress` — для включения сжатия файлов во время передачи.
- `—compress-level=<число>` — для установки уровня сжатия от 0 до 9.
- `—exclude=<имена файлов>` — для исключения из синхронизации файлов.
- `—exclude-from=<имя файла>` — для исключения из синхронизации файлов, указанных в файле.
- `—include=<имена файлов>` — для включения в синхронизацию файлов.
- `—include-from=<имя файла>` — для включения в синхронизацию файлов, указанных в файле.
- `—port=<порт>` — для установки сетевого порта для подключения на удаленном узле.
- `—progress` — для включения строки прогресса при синхронизации.
- `—log-file=<файл>` — для указания места расположения лог-файла.
- `—password-file=<файл>` — При аутентификации пароль можно хранить в специальном файле. Это необходимо для автоматизации выполнения команды без пароля.
- `—list-only` — для отображения имен файлов без копирования.
- `—bwlimit=<число>` — для ограничения скорости передачи в Кбит/c.
- `-4, —ipv4` — приоритет использования IPv4.
- `-6, —ipv6` — приоритет использования IPv6.
- `—version` — для вывода версии Rsync.


## Копирование и синхронизация файлов с rsync локально

При локальном режиме работы достаточно задать каталог/файл-источник и каталог/файл-приемник:

```shell
rsync -avzhHl /path/of/source/folder /path/to/destination/folder
```

## Копирование и синхронизация файлов с rsync удаленно

Если копирование нужно выполнить с удаленным узлом, добавляется имя пользователя и IP-адрес или имя узла:

```shell
rsync -avzhHl /path/of/source/folder root@192.168.56.1:/path/to/destination/folder
```

По умолчанию синхронизация выполняется по протоколу SSH, дополнительные параметры для этого указывать не требуется. 
Чтобы обращаться напрямую к rsync (по протоколу rsync), минуя SSH, на сервере-приемнике должен быть запущен демон Rsync.


## Источники

1. [https://selectel.ru/blog/rsync-guide/](https://selectel.ru/blog/rsync-guide/)
2. [https://losst.pro/rsync-primery-sinhronizatsii](https://losst.pro/rsync-primery-sinhronizatsii)